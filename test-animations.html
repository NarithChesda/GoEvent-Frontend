<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scroll Animation Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .section {
            margin: 4rem 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            opacity: 0;
            transform: translateY(60px);
            transition: opacity 0.6s cubic-bezier(0.19, 1, 0.22, 1), 
                        transform 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }
        
        .section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .section h2 {
            margin-bottom: 1rem;
            font-size: 2rem;
            background: linear-gradient(45deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section p {
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .test-results {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 300px;
        }
        
        .performance-monitor {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 1s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                transition-delay: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="test-results" id="testResults">
        <h3>Animation Test Results</h3>
        <div id="results">Initializing...</div>
    </div>
    
    <div class="performance-monitor" id="performanceMonitor">
        <div>FPS: <span id="fps">--</span></div>
        <div>Memory: <span id="memory">--</span></div>
        <div>Scroll Events: <span id="scrollEvents">0</span></div>
        <div>Intersection Events: <span id="intersectionEvents">0</span></div>
    </div>
    
    <div class="hero">
        <div>
            <h1>Scroll Animation System Test</h1>
            <p>Scroll down to test the reveal animations</p>
        </div>
    </div>
    
    <div class="container">
        <div class="section" data-testid="section-1">
            <h2>Animation Type: Slide Up</h2>
            <p>This section should animate with a slide up effect when scrolled into view. The animation uses CSS transforms and opacity transitions with cubic-bezier easing for smooth motion.</p>
        </div>
        
        <div class="section" data-testid="section-2">
            <h2>Intersection Observer</h2>
            <p>This section tests the Intersection Observer API implementation. The observer should trigger when elements come into the viewport with proper threshold detection.</p>
        </div>
        
        <div class="section" data-testid="section-3">
            <h2>Performance Monitoring</h2>
            <p>Performance metrics are tracked including FPS, memory usage, and event counts. Animations should maintain 60fps for smooth user experience.</p>
        </div>
        
        <div class="section" data-testid="section-4">
            <h2>Accessibility Support</h2>
            <p>The system respects prefers-reduced-motion settings and provides fallbacks for users who prefer minimal animations.</p>
        </div>
        
        <div class="section" data-testid="section-5">
            <h2>Memory Management</h2>
            <p>Proper cleanup of observers and event listeners ensures no memory leaks. Will-change properties are optimized for performance.</p>
        </div>
        
        <div class="section" data-testid="section-6">
            <h2>Throttled Scroll Events</h2>
            <p>Scroll events are throttled using requestAnimationFrame for optimal performance and consistent 60fps animations.</p>
        </div>
        
        <div class="section" data-testid="section-7">
            <h2>Cross-browser Compatibility</h2>
            <p>Animations work across modern browsers with appropriate fallbacks for older browsers that don't support newer CSS features.</p>
        </div>
        
        <div class="section" data-testid="section-8">
            <h2>Stagger Animations</h2>
            <p>Multiple elements can be animated with staggered timing for visually appealing sequential reveals.</p>
        </div>
    </div>

    <script>
        // Animation Testing System
        class AnimationTester {
            constructor() {
                this.observer = null;
                this.animatedElements = new Set();
                this.startTime = performance.now();
                this.frameCount = 0;
                this.scrollEventCount = 0;
                this.intersectionEventCount = 0;
                this.lastFrameTime = this.startTime;
                
                this.init();
            }
            
            init() {
                this.setupIntersectionObserver();
                this.setupPerformanceMonitoring();
                this.setupEventListeners();
                this.updateResults('Initialization complete');
            }
            
            setupIntersectionObserver() {
                const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                
                this.observer = new IntersectionObserver(
                    (entries) => {
                        entries.forEach((entry) => {
                            this.intersectionEventCount++;
                            
                            if (entry.isIntersecting) {
                                const element = entry.target;
                                const elementId = element.getAttribute('data-testid');
                                
                                if (!this.animatedElements.has(elementId)) {
                                    this.animatedElements.add(elementId);
                                    
                                    if (prefersReducedMotion) {
                                        element.style.opacity = '1';
                                        element.style.transform = 'none';
                                    } else {
                                        element.classList.add('visible');
                                    }
                                    
                                    this.updateResults(`Animated: ${elementId}`);
                                }
                            }
                        });
                        
                        this.updatePerformanceMetrics();
                    },
                    {
                        threshold: 0.1,
                        rootMargin: '0px 0px -100px 0px'
                    }
                );
                
                // Observe all sections
                document.querySelectorAll('.section').forEach(section => {
                    this.observer.observe(section);
                });
            }
            
            setupPerformanceMonitoring() {
                // FPS monitoring
                const measureFPS = () => {
                    this.frameCount++;
                    const currentTime = performance.now();
                    const elapsed = currentTime - this.startTime;
                    
                    if (elapsed >= 1000) {
                        const fps = Math.round((this.frameCount * 1000) / elapsed);
                        document.getElementById('fps').textContent = fps;
                        this.frameCount = 0;
                        this.startTime = currentTime;
                    }
                    
                    requestAnimationFrame(measureFPS);
                };
                
                requestAnimationFrame(measureFPS);
                
                // Memory monitoring (if available)
                if (performance.memory) {
                    setInterval(() => {
                        const memory = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                        document.getElementById('memory').textContent = memory + ' MB';
                    }, 1000);
                }
            }
            
            setupEventListeners() {
                // Throttled scroll event counter
                let scrollTimer = null;
                window.addEventListener('scroll', () => {
                    this.scrollEventCount++;
                    
                    if (scrollTimer === null) {
                        scrollTimer = setTimeout(() => {
                            document.getElementById('scrollEvents').textContent = this.scrollEventCount;
                            document.getElementById('intersectionEvents').textContent = this.intersectionEventCount;
                            scrollTimer = null;
                        }, 100);
                    }
                }, { passive: true });
            }
            
            updateResults(message) {
                const results = document.getElementById('results');
                const timestamp = new Date().toLocaleTimeString();
                results.innerHTML = `
                    <div>${timestamp}: ${message}</div>
                    <div>Animated Elements: ${this.animatedElements.size}</div>
                    <div>Reduced Motion: ${window.matchMedia('(prefers-reduced-motion: reduce)').matches}</div>
                    <div>Observer Active: ${this.observer !== null}</div>
                `;
            }
            
            updatePerformanceMetrics() {
                // Update performance indicators
                const currentTime = performance.now();
                const frameTime = currentTime - this.lastFrameTime;
                this.lastFrameTime = currentTime;
                
                // Check if animation is smooth (< 20ms per frame for 60fps)
                if (frameTime > 20) {
                    console.warn('Potential performance issue detected:', frameTime + 'ms frame time');
                }
            }
            
            cleanup() {
                if (this.observer) {
                    this.observer.disconnect();
                }
            }
        }
        
        // Initialize the animation tester
        const tester = new AnimationTester();
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            tester.cleanup();
        });
        
        // Test specific animation features
        const runAnimationTests = () => {
            const tests = [
                {
                    name: 'Intersection Observer Support',
                    test: () => 'IntersectionObserver' in window
                },
                {
                    name: 'CSS Transform Support',
                    test: () => 'transform' in document.documentElement.style
                },
                {
                    name: 'CSS Transition Support',
                    test: () => 'transition' in document.documentElement.style
                },
                {
                    name: 'RequestAnimationFrame Support',
                    test: () => 'requestAnimationFrame' in window
                },
                {
                    name: 'Backdrop Filter Support',
                    test: () => 'backdropFilter' in document.documentElement.style || 'webkitBackdropFilter' in document.documentElement.style
                },
                {
                    name: 'Will Change Support',
                    test: () => 'willChange' in document.documentElement.style
                },
                {
                    name: 'Prefers Reduced Motion Support',
                    test: () => window.matchMedia('(prefers-reduced-motion)').media !== 'not all'
                }
            ];
            
            console.group('🧪 Animation System Tests');
            tests.forEach(({ name, test }) => {
                const result = test();
                console.log(`${result ? '✅' : '❌'} ${name}:`, result);
            });
            console.groupEnd();
        };
        
        // Run tests on load
        document.addEventListener('DOMContentLoaded', runAnimationTests);
    </script>
</body>
</html>