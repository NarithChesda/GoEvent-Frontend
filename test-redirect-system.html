<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Showcase Redirect System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #333;
            margin-top: 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        code {
            background: #f8f9fa;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Event Showcase Redirect System - Test Page</h1>
    
    <div class="test-section">
        <h2>Test Scenarios</h2>
        <p>This page helps test the redirect system functionality for the event showcase. 
           Open your browser's console to see detailed logs.</p>
        
        <div class="status info">
            <strong>Instructions:</strong> 
            <ol>
                <li>First visit an event showcase page normally to establish initial state</li>
                <li>Then use these test links to simulate different redirect scenarios</li>
                <li>Check that the showcase skips directly to main content when appropriate</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2>1. First Time Visit (Should start from cover stage)</h2>
        <button class="test-button" onclick="testFirstVisit()">Test First Visit</button>
        <div id="first-visit-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Language Change Redirect (Should skip to main content)</h2>
        <button class="test-button" onclick="testLanguageChange()">Test Language Change</button>
        <div id="language-change-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Login Redirect to RSVP (Should skip to main content + scroll to RSVP)</h2>
        <button class="test-button" onclick="testLoginRSVP()">Test Login → RSVP</button>
        <div id="login-rsvp-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Login Redirect to Comments (Should skip to main content + scroll to comments)</h2>
        <button class="test-button" onclick="testLoginComments()">Test Login → Comments</button>
        <div id="login-comments-result"></div>
    </div>

    <div class="test-section">
        <h2>5. Clear Redirect State (Reset for testing)</h2>
        <button class="test-button" onclick="clearRedirectState()">Clear State</button>
        <div id="clear-state-result"></div>
    </div>

    <div class="test-section">
        <h2>Current LocalStorage State</h2>
        <button class="test-button" onclick="showCurrentState()">Show Current State</button>
        <div id="current-state-result"></div>
    </div>

    <script>
        // Test configuration - Replace with actual event ID
        const TEST_EVENT_ID = 'test-event-123';
        const BASE_URL = 'http://localhost:5175';
        
        function testFirstVisit() {
            const url = `${BASE_URL}/events/${TEST_EVENT_ID}/showcase`;
            window.open(url, '_blank');
            document.getElementById('first-visit-result').innerHTML = 
                `<div class="status info">Opened: <code>${url}</code><br>This should start from cover stage.</div>`;
        }
        
        function testLanguageChange() {
            // Simulate that user has already seen main content
            setMockRedirectState();
            
            const url = `${BASE_URL}/events/${TEST_EVENT_ID}/showcase?lang=kh`;
            window.open(url, '_blank');
            document.getElementById('language-change-result').innerHTML = 
                `<div class="status info">Opened: <code>${url}</code><br>This should skip directly to main content.</div>`;
        }
        
        function testLoginRSVP() {
            setMockRedirectState();
            
            const url = `${BASE_URL}/events/${TEST_EVENT_ID}/showcase#rsvp`;
            window.open(url, '_blank');
            document.getElementById('login-rsvp-result').innerHTML = 
                `<div class="status info">Opened: <code>${url}</code><br>This should skip to main content and scroll to RSVP section.</div>`;
        }
        
        function testLoginComments() {
            setMockRedirectState();
            
            const url = `${BASE_URL}/events/${TEST_EVENT_ID}/showcase#comment-section`;
            window.open(url, '_blank');
            document.getElementById('login-comments-result').innerHTML = 
                `<div class="status info">Opened: <code>${url}</code><br>This should skip to main content and scroll to comments.</div>`;
        }
        
        function clearRedirectState() {
            localStorage.removeItem('goevent_showcase_redirect_state');
            document.getElementById('clear-state-result').innerHTML = 
                `<div class="status success">Redirect state cleared from localStorage.</div>`;
        }
        
        function showCurrentState() {
            const state = localStorage.getItem('goevent_showcase_redirect_state');
            let content;
            
            if (state) {
                try {
                    const parsed = JSON.parse(state);
                    content = `<div class="status info"><strong>Current State:</strong><br><pre>${JSON.stringify(parsed, null, 2)}</pre></div>`;
                } catch (e) {
                    content = `<div class="status info"><strong>Raw State:</strong><br><code>${state}</code></div>`;
                }
            } else {
                content = `<div class="status info">No redirect state found in localStorage.</div>`;
            }
            
            document.getElementById('current-state-result').innerHTML = content;
        }
        
        function setMockRedirectState() {
            // Create a mock state indicating user has seen main content
            const mockState = {
                [TEST_EVENT_ID]: {
                    eventId: TEST_EVENT_ID,
                    hasSeenMainContent: true,
                    lastVisitStage: 'main_content',
                    timestamp: Date.now()
                }
            };
            
            localStorage.setItem('goevent_showcase_redirect_state', JSON.stringify(mockState));
            console.log('Mock redirect state set:', mockState);
        }
        
        // Auto-show current state on page load
        showCurrentState();
        
        console.log('Showcase Redirect System Test Page Loaded');
        console.log('Available test functions:', {
            testFirstVisit,
            testLanguageChange,
            testLoginRSVP,
            testLoginComments,
            clearRedirectState,
            showCurrentState,
            setMockRedirectState
        });
    </script>
</body>
</html>