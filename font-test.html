<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Font Loading Test - Tom Template 3</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .font-sample {
            font-size: 24px;
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .khmer-font {
            font-family: 'KhmerOSMoulPali', serif;
        }
        .english-primary {
            font-family: 'BrushScript', cursive;
        }
        .english-secondary {
            font-family: 'Poppins-Regular', sans-serif;
        }
        .loading-status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>Font Loading Test - Tom Template 3</h1>
    
    <div class="test-section">
        <h2>Font File URLs Test</h2>
        <p>Testing accessibility of font files from the backend:</p>
        <div id="font-urls-status"></div>
    </div>
    
    <div class="test-section">
        <h2>Font Loading Test</h2>
        <p>Loading custom fonts from Tom Template 3...</p>
        <div id="font-loading-status"></div>
    </div>
    
    <div class="test-section">
        <h2>Font Display Test</h2>
        
        <div class="font-sample khmer-font">
            <strong>Khmer Font (KhmerOSMoulPali):</strong><br>
            ·ûÅ·üí·ûò·üÇ·ûö·û¢·ûÄ·üí·ûü·ûö·ûü·üí·ûö·ûü·üã·ûü·üí·û¢·û∂·ûè - Beautiful Khmer Letters
        </div>
        
        <div class="font-sample english-primary">
            <strong>English Primary (BrushScript):</strong><br>
            Elegant Wedding Invitation Script Font
        </div>
        
        <div class="font-sample english-secondary">
            <strong>English Secondary (Poppins-Regular):</strong><br>
            Clean and Modern Body Text Font for Invitations
        </div>
    </div>
    
    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';
        
        // Font definitions from Tom Template 3
        const fonts = [
            {
                name: 'KhmerOSMoulPali',
                file: '/media/fonts/KhmerOSMoulpali.ttf',
                language: 'kh',
                type: 'primary'
            },
            {
                name: 'BrushScript',
                file: '/media/fonts/Brush_Script.ttf',
                language: 'en',
                type: 'primary'
            },
            {
                name: 'Poppins-Regular',
                file: '/media/fonts/Poppins-Regular.ttf',
                language: 'en',
                type: 'secondary'
            }
        ];
        
        // Test font URLs accessibility
        async function testFontUrls() {
            const statusDiv = document.getElementById('font-urls-status');
            statusDiv.innerHTML = '<p>Testing font URL accessibility...</p>';
            
            for (const font of fonts) {
                const url = `${API_BASE_URL}${font.file}`;
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    const status = response.ok ? 'success' : 'error';
                    const message = response.ok 
                        ? `‚úÖ ${font.name}: Accessible (${response.status})`
                        : `‚ùå ${font.name}: Failed (${response.status})`;
                    
                    statusDiv.innerHTML += `<div class="${status}">${message}</div>`;
                } catch (error) {
                    statusDiv.innerHTML += `<div class="error">‚ùå ${font.name}: Error - ${error.message}</div>`;
                }
            }
        }
        
        // Load fonts dynamically
        async function loadFonts() {
            const statusDiv = document.getElementById('font-loading-status');
            statusDiv.innerHTML = '<p>Loading fonts...</p>';
            
            for (const font of fonts) {
                const url = `${API_BASE_URL}${font.file}`;
                try {
                    console.log(`üîó Loading font: ${font.name} from ${url}`);
                    
                    // Check if font is already loaded
                    const fontExists = document.fonts.check(`12px "${font.name}"`);
                    
                    if (!fontExists) {
                        const fontFace = new FontFace(font.name, `url(${url})`);
                        const loadedFont = await fontFace.load();
                        document.fonts.add(loadedFont);
                        
                        statusDiv.innerHTML += `<div class="success">‚úÖ Successfully loaded: ${font.name} (${font.type} - ${font.language})</div>`;
                        console.log(`‚úÖ Successfully loaded font: ${font.name}`);
                    } else {
                        statusDiv.innerHTML += `<div class="success">‚ö° Font already exists: ${font.name}</div>`;
                        console.log(`‚ö° Font already exists: ${font.name}`);
                    }
                } catch (error) {
                    statusDiv.innerHTML += `<div class="error">‚ùå Failed to load ${font.name}: ${error.message}</div>`;
                    console.error(`‚ùå Failed to load font: ${font.name}`, error);
                }
            }
        }
        
        // Run tests when page loads
        window.addEventListener('load', async () => {
            console.log('üé® Starting font tests...');
            await testFontUrls();
            await loadFonts();
            
            // Give fonts a moment to apply
            setTimeout(() => {
                console.log('üìù Font loading complete. Check the display samples above.');
            }, 1000);
        });
    </script>
</body>
</html>